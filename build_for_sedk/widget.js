(()=>{"use strict";var e;function t(){var t=document.getElementById("streamer-summary"),a=document.getElementById("streamer-task-list");t.innerText=e.streamerSummary,a.innerHTML="",e.streamerTasks.forEach(function(e){var t=document.createElement("li");t.innerText=e.title,e.completed&&t.classList.add("completed"),a.appendChild(t)})}function a(){var t=document.getElementById("viewer-task-list");t.innerHTML="",e.viewerTasks.approved.forEach(function(e){var a=document.createElement("li");a.innerHTML='<span class="viewer-name">['.concat(e.user,"]</span> ").concat(e.title),"completed"===e.status?a.classList.add("completed"):"paused"===e.status&&a.classList.add("paused"),e.offline&&a.classList.add("offline"),t.appendChild(a)})}function s(e){console.log("CHATBOT: ".concat(e))}function r(){e.progress++,n()}function n(){var t=Math.min(e.progress/12*100,100),a=document.getElementById("progress-bar"),r=document.getElementById("progress-bar-text");a.style.width="".concat(t,"%"),r.innerText="".concat(e.progress,"/").concat(12," Tasks Completed"),3!==e.progress&&7!==e.progress&&12!==e.progress||s("Focus Bar TIER REACHED! (".concat(e.progress,"/").concat(12,")"))}function o(t,s){var r=e.viewerTasks.approved.find(function(e){return e.user.toLowerCase()===t.toLowerCase()});r&&(r.offline="part"===s,a())}window.addEventListener("onWidgetLoad",function(s){var r,o,i;r=s.detail.fieldData,e={streamerSummary:r.streamerSummary,streamerTasks:(o=r.streamerTasks,o.split("\n").map(function(e){return{title:e.trim(),completed:!1}}).filter(function(e){return""!==e.title})),viewerTasks:{pending:[],approved:[]},progress:0,config:{taskLimit:r.taskLimit,textColor:r.textColor,backgroundColor:r.backgroundColor,progressBarColor:r.progressBarColor}},t(),a(),n(),(i=document.body).style.color=e.config.textColor,i.style.backgroundColor=e.config.backgroundColor,document.getElementById("progress-bar").style.backgroundColor=e.config.progressBarColor}),window.addEventListener("onEventReceived",function(i){if("viewer-joined"!==i.detail.listener)if("viewer-left"!==i.detail.listener){if("message"===i.detail.listener){var c,d,l=i.detail.event.data,u=l.text.split(" ")[0],p=l.text.substring(u.length+1),f=l.displayName,m="1"===l.tags.mod,v=f.toLowerCase()===i.detail.channel.username.toLowerCase();"!donestreamer"===u&&(m||v)?(c=p,(d=e.streamerTasks.find(function(e){return e.title.toLowerCase()===c.toLowerCase()}))&&!d.completed&&(d.completed=!0,r(),t())):"!task"===u?function(t,a){a&&(e.viewerTasks.pending.find(function(e){return e.user===t})?s("@".concat(t,", you already have a task pending approval.")):e.viewerTasks.approved.find(function(e){return e.user===t})?s("@".concat(t,", you already have an active task.")):(e.viewerTasks.pending.push({user:t,title:a,status:"pending",offline:!1}),s("@".concat(t,', your task "').concat(a,'" has been received and is pending approval!'))))}(f,p):"!approve"===u&&(m||v)?function(t){if(e.viewerTasks.approved.length>=e.config.taskLimit)s("Approval failed: Viewer task list is full (max ".concat(e.config.taskLimit,")."));else{var r=e.viewerTasks.pending.findIndex(function(e){return e.user.toLowerCase()===t.toLowerCase()});if(-1!==r){var n=e.viewerTasks.pending.splice(r,1)[0];n.status="approved",e.viewerTasks.approved.push(n),s("@".concat(n.user,", your task has been approved!")),a()}else s('Approval failed: No pending task found for "'.concat(t,'".'))}}(p):"!reject"===u&&(m||v)?function(t){var a=e.viewerTasks.pending.findIndex(function(e){return e.user.toLowerCase()===t.toLowerCase()});if(-1!==a){var r=e.viewerTasks.pending.splice(a,1)[0];s("@".concat(r.user,", your task has been rejected."))}else s('Rejection failed: No pending task found for "'.concat(t,'".'))}(p):"!status"===u?function(t,n){var o=e.viewerTasks.approved.find(function(e){return e.user.toLowerCase()===t.toLowerCase()});if(o){var i=n.toLowerCase();"complete"===i||"pause"===i?("pause"===i?(o.status="paused",s("@".concat(t,", your task is now paused."))):"complete"===i&&(o.status="completed",s("@".concat(t,", congratulations on completing your task!")),r()),a()):s("@".concat(t,", invalid status. Use 'complete' or 'pause'."))}else s("@".concat(t,", you do not have an active task to update."))}(f,p):"!resetday"===u&&(m||v)&&(e.streamerTasks.forEach(function(e){return e.completed=!1}),e.viewerTasks.pending=[],e.viewerTasks.approved=[],e.progress=0,t(),a(),n(),s("A new day has begun! All tasks have been reset."))}}else o(i.detail.event.username,"part");else o(i.detail.event.username,"join")}),console.log("CST Widget Logic Loaded")})();